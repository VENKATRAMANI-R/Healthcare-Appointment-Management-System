<h1 class="appointment-title" >Book an Appointment</h1>

<div id="container">
  <form [formGroup]="appointmentForm" (ngSubmit)="onSubmit()">
    <div id="getDetails" class="form-group">

      <span>
        <label for="PatientID">Patient ID</label>
        <input type="text" id="PatientID" formControlName="patId" readonly />
      </span>
      <br>

      <span>
        <label for="PatientName">Patient Name</label>
        <input type="text" id="PatientName" formControlName="patientName" readonly />
      </span>
      <br>

      <span>
        <label for="DoctorName">Doctor Name</label>
        <input type="text" id="DoctorName" formControlName="doctorName" readonly />
      </span>
      <br>

      <span>
        <label for="Date">Date</label>
        <input 
          type="date" 
          id="Date" 
          formControlName="date" 
          (change)="onDateSelected()"
          [min]="getTodayDate()"
          required
        />
        <small class="form-text">Select a date within the next 30 days.</small>
      </span>

      <div class="time-inputs">
        <span class="start-time">
          <label for="StartTime">Start Time</label>
          <select 
            id="StartTime"
            formControlName="startTime"
            (change)="onTimeSelected()"
            [disabled]="!availableStartTimes.length"
            required
          >
            <option value="">Select start time</option>
            <option *ngFor="let time of availableStartTimes" [value]="time">
              {{ time }}
            </option>
          </select>

          <div *ngIf="isLoadingSlots" class="loading-text">
            Loading available slots...
          </div>

          <div 
            *ngIf="!isLoadingSlots && availableStartTimes.length === 0 && appointmentForm.get('date')?.value" 
            class="no-slots-text"
          >
            No available slots for selected date
          </div>
        </span>

        <span class="end-time">
          <label for="EndTime">End Time</label>
          <input type="text" id="EndTime" formControlName="endTime" readonly />
        </span>
      </div>

      <span>
        <label for="Problem">Problem</label>
        <input 
          type="text"
          id="Problem"
          formControlName="problem"
          maxlength="50"
          placeholder="Problem in 50 characters"
        />
        <small class="form-text">
          {{ appointmentForm.get('problem')?.value?.length || 0 }}/50
        </small>
      </span>

      <div>
        <button class="btn btn-outline" type="submit" [disabled]="!appointmentForm.valid">Book Now</button>
        <button class="btn btn-outline" type="button" (click)="onClick()">View Appointment</button>
      </div>

    </div>
  </form>
</div>
